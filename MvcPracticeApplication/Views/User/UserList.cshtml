
@{

    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    ViewModel.Model.Session sess = new ViewModel.Model.Session();
    sess = (ViewModel.Model.Session)HttpContext.Current.Session["Session"];
}
<script src="~/Scripts/CommonList.js"></script>

<!-- Content area -->
<input id="delete_id" type="hidden" />

<div class="container-fluid">

    <!-- Exportable Table -->
    <div class="row clearfix">
        <div class="col-lg-12">
            <div class="card">
                <div class="body">
                    <div class="table table-bordered table-striped table-hover dataTable js-exportable">
                        <div id="dataGrid" class="js-exportable" style="width:100%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /content area -->
    <div id="myModal" tabindex="-1" aria-modal="true" class="modal modal-adminpro-general default-popup-PrimaryModal fade bounceIn animated in" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title card-title">
                        Add New 
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </h4>
                </div>
            </div>
        </div>
    </div>
</div>






<script>
        $(document).ready(function () {

            GetUserRecords();

        });
        function GetUserRecords() {
            var url = "/User/GetAllUsers";
            $.ajax({
                url: url,
                method: "Get",
                data: {},
                async: false,
                cache: false,
            }).done(function (result) {
                debugger;
                result = JSON.parse(result.response)
                var JSON_Data = result.UserList;
                if (JSON_Data.length !== 0) {
                      //setTimeout(function () { $("#dataGrid input.dx-texteditor-input").attr("placeholder", "Search..."); }, 3000);
                    dataGrid = $("#dataGrid").dxDataGrid({
                        dataSource: JSON_Data,
                        columnsAutoWidth: true,
                        showBorders: true,
                        filterRow: {
                            visible: true,
                            applyFilter: "auto"
                        },
                        headerFilter: {
                            visible: true
                        },
                        paging: {
                            pageSize: 8
                        },
                        //  keyExpr: "ID",
                        onCellPrepared: function (e, options) {

                            if (e.rowType == 'data') {
                                if (e.column.dataField == 'IsActive' && e.data.IsActive == true) {
                                    e.cellElement.addClass('DevExtrCellGreen');
                                }
                                if (e.column.dataField == 'IsActive' && e.data.IsActive == false) {
                                    e.cellElement.addClass('DevExtrCellRed');
                                }
                            }
                        },
                        columns:
                            [
                                    {
                                        dataField: "Role_ID",
                                        caption: "Role_ID",
                                        dataType: "int",
                                        width: "auto"

                                    },
                                    {
                                        dataField: "First_Name",
                                        caption: "First_Name",
                                        dataType: "string",
                                        width: "auto"

                                    },
                                        {
                                            dataField: "IsActive",
                                            caption: "Is Active",
                                            dataType: "string",
                                            width: "auto",
                                            calculateCellValue: function (data) {
                                                if (data.IsActive == true)
                                                    return ["Active"];
                                                if (data.IsActive == false)
                                                    return ["InActive"];

                                            }

                                        },
                                   {
                                       dataField: "Created_At",
                                       caption: "Created At",
                                       dataType: "string",
                                       width: "auto"

                                   },

                            {
                                dataField: "ID",
                                caption: "Action",
                                width: "auto",
                                cellTemplate: function (container, options, data) {
                                    $("<div>")
                                         .append($("<a class='cstm-tableicon' data-toggle='modal' href='#myModalConfirm' onClick='DeleteUser(" + options.data.ID + ")' title='Delete'><i class='icon-bin'><span> Delete</span></i></a>"))
                                         .append($("<a onclick='UpdateUser(" + options.data.ID + ")'title='Update'><i><span>Edit</span></i></a>"))
                                         .appendTo(container);

                                }

                            }
                            ],

                    });

                }
                else {
                    $("#dvBtn").css('display', 'none');
                    AlertToast('warning', 'No record found.');
                }

            }).fail(function () {
            });

        }


        function RedirectToUserEntry(id) {
            window.location.href = '/User/UserEntry?' + 'UserId=' + id;
        }

        function DeleteUser(id) {
            var urls = "/User/DeleteUser?id=" + id;
            var ans = confirm("Are you sure you want to delete this Record?");
            if (ans) {
                $.ajax({
                    url: urls,
                    type: "GET",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: { "id": id },
                    success: function (result) {
                        debugger
                        result = JSON.parse(result.response)
                        var IsSuccess = result.IsSuccess;
                        if (IsSuccess) {
                            GetUserRecords();
                            AlertToast('success', 'Record Deleted Successfully');
                        }
                        else {
                            AlertToast('warning', result.Message)
                        }
                    },
                    error: function (response) {
                        AlertToast('warning', response.Message)
                    }
                });
            }
        }

</script>

